// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var $form, $identifier, $result, activeRequest, doService, getActiveService, parseFormData, renderError, renderResult, renderSucces, services, setIdentifer, waitingPanda;
    $form = $('form.remindergram');
    $identifier = $('#identifier');
    $result = $('.result');
    services = {
      'Instagram': 'Username',
      'WordPress': 'Blog address',
      'RSS': 'Feed address'
    };
    activeRequest = false;
    $form.find('.btn').on('click', function(event) {
      event.preventDefault();
      $form.find('.btn').removeClass('active');
      $(this).addClass('active');
      return doService($(event.target).text());
    });
    getActiveService = function() {
      var active;
      active = $form.find('.btn.active');
      if (active) {
        return active.text();
      } else {
        return '';
      }
    };
    doService = function(name) {
      return setIdentifer(services[name]);
    };
    setIdentifer = function(placeholder) {
      $('label[for="identifier"]').text("Enter " + placeholder);
      return $identifier.attr('placeholder', placeholder);
    };
    $form.on('submit', function(event) {
      var data, timer;
      event.preventDefault();
      if (this.activeRequest) {
        this.activeRequest.abort();
      }
      data = parseFormData($form);
      timer = waitingPanda();
      return this.activeRequest = $.post($form.attr('action'), data, function(response) {
        clearTimeout(timer);
        if (response.error) {
          return renderError(response);
        } else {
          return renderSucces(response);
        }
      });
    });
    $form.keyup(function() {
      clearTimeout(this.keyup_timer);
      return this.keyup_timer = setTimeout(function() {
        return $form.submit();
      }, 800);
    });
    parseFormData = function($form) {
      var inputs;
      inputs = _.reduce($form.serializeArray(), function(data, pair) {
        data[pair.name] = pair.value;
        return data;
      }, {});
      return _.extend(inputs, {
        'service': getActiveService()
      });
    };
    renderSucces = function(response) {
      var compiled;
      compiled = _.template('<ul><% _.each(photos, function(photo) { %>\
				<li><img src="<%= photo %>"></li> <% });\
			%></ul>', {
        photos: response
      });
      return renderResult(compiled);
    };
    renderError = function(response) {
      var compiled;
      compiled = _.template('Oops, there was an error: <%= error %>', response);
      return renderResult(compiled);
    };
    renderResult = function(html) {
      return $result.html(html);
    };
    return waitingPanda = function() {
      var compiled;
      compiled = _.template('<img src="<%= src %>">', {
        src: 'http://25.media.tumblr.com/tumblr_ly2em98lub1r3m4cbo1_400.gif'
      });
      return setTimeout(function() {
        return renderResult(compiled);
      }, 500);
    };
  });

}).call(this);
